import type { ResourceIntegrationTestConfig } from "src/tests/resource-integration.test";
import StoryResourceCollectionRestoreService from "../services/StoryResourceCollectionRestoreService";
import { ResourceType } from "@core/types/types";

const config: ResourceIntegrationTestConfig = {
  name: "Nested Stories",
  description:
    "Test parent-child story relationships with ID mapping and topological sorting",
  ServiceClass: StoryResourceCollectionRestoreService,
  initialMappingRegistry: {
    [ResourceType.STORIES]: {
      oldIdToNewIdMap: {
        100001: 200001, // Parent story mapping
      },
      oldUuidToNewUuidMap: {},
    },
  },
  resources: [
    {
      input: {
        id: 100001,
        name: "parent-story",
        slug: "parent-story",
        full_slug: "parent-story",
        parent_id: 0,
        is_folder: true,
        published: true,
        content: {
          body: [],
          component: "page",
        },
        created_at: "2025-01-01T00:00:00.000Z",
        updated_at: "2025-01-01T00:00:00.000Z",
        published_at: "2025-01-01T00:00:00.000Z",
        first_published_at: "2025-01-01T00:00:00.000Z",
        last_author_id: 100001,
        position: 0,
        tag_list: [],
        alternates: [],
        translated_slugs: [],
        localized_paths: [],
        translated_stories: [],
        breadcrumbs: [],
        user_ids: [],
        space_role_ids: [],
        group_id: "test-group-id-1",
        uuid: "test-uuid-1",
        path: null,
        default_root: "page",
        disble_fe_editor: true,
        disable_fe_editor: true,
        parent: null,
        is_startpage: false,
        unpublished_changes: false,
        meta_data: null,
        imported_at: null,
        pinned: false,
        publish_at: null,
        expire_at: null,
        can_not_view: false,
        is_scheduled: null,
        scheduled_dates: null,
        ideas: [],
        stage: null,
        favourite_for_user_ids: [],
        deleted_at: null,
        sort_by_date: null,
        last_author: {
          id: 100001,
          userid: "test-user-1",
          friendly_name: "Test User 1",
        },
      },
      expectedApiCall: {
        endpointSuffix: "stories",
        body: {
          story: {
            id: 100001,
            name: "parent-story",
            slug: "parent-story",
            full_slug: "parent-story",
            parent_id: 0,
            is_folder: true,
            published: true,
            content: {
              body: [],
              component: "page",
            },
            created_at: "2025-01-01T00:00:00.000Z",
            updated_at: "2025-01-01T00:00:00.000Z",
            published_at: "2025-01-01T00:00:00.000Z",
            first_published_at: "2025-01-01T00:00:00.000Z",
            last_author_id: 100001,
            position: 0,
            tag_list: [],
            alternates: [],
            translated_slugs: [],
            localized_paths: [],
            translated_stories: [],
            breadcrumbs: [],
            user_ids: [],
            space_role_ids: [],
            group_id: "test-group-id-1",
            uuid: "test-uuid-1",
            path: null,
            default_root: "page",
            disble_fe_editor: true,
            disable_fe_editor: true,
            parent: null,
            is_startpage: false,
            unpublished_changes: false,
            meta_data: null,
            imported_at: null,
            pinned: false,
            publish_at: null,
            expire_at: null,
            can_not_view: false,
            is_scheduled: null,
            scheduled_dates: null,
            ideas: [],
            stage: null,
            favourite_for_user_ids: [],
            deleted_at: null,
            sort_by_date: null,
            last_author: {
              id: 100001,
              userid: "test-user-1",
              friendly_name: "Test User 1",
            },
          },
          force_update: 1,
          publish: 1,
        },
      },
      mockResponse: {
        data: {
          story: {
            id: 200001, // New ID after restoration
            name: "parent-story",
            slug: "parent-story",
            full_slug: "parent-story",
            parent_id: 0,
            is_folder: true,
            published: true,
            content: {
              body: [],
              component: "page",
            },
            created_at: "2025-01-01T00:00:00.000Z",
            updated_at: "2025-01-01T00:00:00.000Z",
            published_at: "2025-01-01T00:00:00.000Z",
            first_published_at: "2025-01-01T00:00:00.000Z",
            last_author_id: 100001,
            position: 0,
            tag_list: [],
            alternates: [],
            translated_slugs: [],
            localized_paths: [],
            translated_stories: [],
            breadcrumbs: [],
            user_ids: [],
            space_role_ids: [],
            group_id: "test-group-id-1",
            uuid: "test-uuid-1",
            path: null,
            default_root: "page",
            disble_fe_editor: true,
            disable_fe_editor: true,
            parent: null,
            is_startpage: false,
            unpublished_changes: false,
            meta_data: null,
            imported_at: null,
            pinned: false,
            publish_at: null,
            expire_at: null,
            can_not_view: false,
            is_scheduled: null,
            scheduled_dates: null,
            ideas: [],
            stage: null,
            favourite_for_user_ids: [],
            deleted_at: null,
            sort_by_date: null,
            last_author: {
              id: 100001,
              userid: "test-user-1",
              friendly_name: "Test User 1",
            },
          },
        },
      },
    },
    {
      input: {
        id: 100002,
        name: "child-story",
        slug: "child-story",
        full_slug: "parent-story/child-story",
        parent_id: 100001, // Should be replaced with mapped ID
        is_folder: false,
        published: true,
        content: {
          _uid: "test-uid-2",
          component: "page",
          body: [],
        },
        created_at: "2025-01-01T00:00:00.000Z",
        updated_at: "2025-01-01T00:00:00.000Z",
        published_at: "2025-01-01T00:00:00.000Z",
        first_published_at: "2025-01-01T00:00:00.000Z",
        last_author_id: 100002,
        position: 0,
        tag_list: [],
        alternates: [],
        translated_slugs: [],
        localized_paths: [],
        translated_stories: [],
        breadcrumbs: [],
        user_ids: [],
        space_role_ids: [],
        group_id: "test-group-id-2",
        uuid: "test-uuid-2",
        path: null,
        default_root: null,
        disble_fe_editor: false,
        disable_fe_editor: false,
        parent: null,
        is_startpage: false,
        unpublished_changes: false,
        meta_data: null,
        imported_at: null,
        pinned: false,
        publish_at: null,
        expire_at: null,
        can_not_view: false,
        is_scheduled: null,
        scheduled_dates: null,
        ideas: [],
        stage: null,
        favourite_for_user_ids: [],
        deleted_at: null,
        sort_by_date: null,
        last_author: {
          id: 100002,
          userid: "test-user-2",
          friendly_name: "Test User 2",
        },
      },
      expectedApiCall: {
        endpointSuffix: "stories",
        body: {
          story: {
            id: 100002,
            name: "child-story",
            slug: "child-story",
            full_slug: "parent-story/child-story",
            parent_id: 200001, // Should be replaced with mapped ID
            is_folder: false,
            published: true,
            content: {
              _uid: "test-uid-2",
              component: "page",
              body: [],
            },
            created_at: "2025-01-01T00:00:00.000Z",
            updated_at: "2025-01-01T00:00:00.000Z",
            published_at: "2025-01-01T00:00:00.000Z",
            first_published_at: "2025-01-01T00:00:00.000Z",
            last_author_id: 100002,
            position: 0,
            tag_list: [],
            alternates: [],
            translated_slugs: [],
            localized_paths: [],
            translated_stories: [],
            breadcrumbs: [],
            user_ids: [],
            space_role_ids: [],
            group_id: "test-group-id-2",
            uuid: "test-uuid-2",
            path: null,
            default_root: null,
            disble_fe_editor: false,
            disable_fe_editor: false,
            parent: null,
            is_startpage: false,
            unpublished_changes: false,
            meta_data: null,
            imported_at: null,
            pinned: false,
            publish_at: null,
            expire_at: null,
            can_not_view: false,
            is_scheduled: null,
            scheduled_dates: null,
            ideas: [],
            stage: null,
            favourite_for_user_ids: [],
            deleted_at: null,
            sort_by_date: null,
            last_author: {
              id: 100002,
              userid: "test-user-2",
              friendly_name: "Test User 2",
            },
          },
          force_update: 1,
          publish: 1,
        },
      },
      mockResponse: {
        data: {
          story: {
            id: 200002, // New ID after restoration
            name: "child-story",
            slug: "child-story",
            full_slug: "parent-story/child-story",
            parent_id: 200001, // Should be replaced with mapped ID
            is_folder: false,
            published: true,
            content: {
              _uid: "test-uid-2",
              component: "page",
              body: [],
            },
            created_at: "2025-01-01T00:00:00.000Z",
            updated_at: "2025-01-01T00:00:00.000Z",
            published_at: "2025-01-01T00:00:00.000Z",
            first_published_at: "2025-01-01T00:00:00.000Z",
            last_author_id: 100002,
            position: 0,
            tag_list: [],
            alternates: [],
            translated_slugs: [],
            localized_paths: [],
            translated_stories: [],
            breadcrumbs: [],
            user_ids: [],
            space_role_ids: [],
            group_id: "test-group-id-2",
            uuid: "test-uuid-2",
            path: null,
            default_root: null,
            disble_fe_editor: false,
            disable_fe_editor: false,
            parent: null,
            is_startpage: false,
            unpublished_changes: false,
            meta_data: null,
            imported_at: null,
            pinned: false,
            publish_at: null,
            expire_at: null,
            can_not_view: false,
            is_scheduled: null,
            scheduled_dates: null,
            ideas: [],
            stage: null,
            favourite_for_user_ids: [],
            deleted_at: null,
            sort_by_date: null,
            last_author: {
              id: 100002,
              userid: "test-user-2",
              friendly_name: "Test User 2",
            },
          },
        },
      },
    },
    {
      input: {
        id: 100003,
        name: "grandchild-story",
        slug: "grandchild-story",
        full_slug: "parent-story/child-story/grandchild-story",
        parent_id: 100002, // Should be replaced with mapped ID
        is_folder: false,
        published: true,
        content: {
          _uid: "test-uid-3",
          component: "page",
          body: [],
        },
        created_at: "2025-01-01T00:00:00.000Z",
        updated_at: "2025-01-01T00:00:00.000Z",
        published_at: "2025-01-01T00:00:00.000Z",
        first_published_at: "2025-01-01T00:00:00.000Z",
        last_author_id: 100003,
        position: 0,
        tag_list: [],
        alternates: [],
        translated_slugs: [],
        localized_paths: [],
        translated_stories: [],
        breadcrumbs: [],
        user_ids: [],
        space_role_ids: [],
        group_id: "test-group-id-3",
        uuid: "test-uuid-3",
        path: null,
        default_root: null,
        disble_fe_editor: false,
        disable_fe_editor: false,
        parent: null,
        is_startpage: false,
        unpublished_changes: false,
        meta_data: null,
        imported_at: null,
        pinned: false,
        publish_at: null,
        expire_at: null,
        can_not_view: false,
        is_scheduled: null,
        scheduled_dates: null,
        ideas: [],
        stage: null,
        favourite_for_user_ids: [],
        deleted_at: null,
        sort_by_date: null,
        last_author: {
          id: 100003,
          userid: "test-user-3",
          friendly_name: "Test User 3",
        },
      },
      expectedApiCall: {
        endpointSuffix: "stories",
        body: {
          story: {
            id: 100003,
            name: "grandchild-story",
            slug: "grandchild-story",
            full_slug: "parent-story/child-story/grandchild-story",
            parent_id: 200002, // Should be replaced with mapped ID
            is_folder: false,
            published: true,
            content: {
              _uid: "test-uid-3",
              component: "page",
              body: [],
            },
            created_at: "2025-01-01T00:00:00.000Z",
            updated_at: "2025-01-01T00:00:00.000Z",
            published_at: "2025-01-01T00:00:00.000Z",
            first_published_at: "2025-01-01T00:00:00.000Z",
            last_author_id: 100003,
            position: 0,
            tag_list: [],
            alternates: [],
            translated_slugs: [],
            localized_paths: [],
            translated_stories: [],
            breadcrumbs: [],
            user_ids: [],
            space_role_ids: [],
            group_id: "test-group-id-3",
            uuid: "test-uuid-3",
            path: null,
            default_root: null,
            disble_fe_editor: false,
            disable_fe_editor: false,
            parent: null,
            is_startpage: false,
            unpublished_changes: false,
            meta_data: null,
            imported_at: null,
            pinned: false,
            publish_at: null,
            expire_at: null,
            can_not_view: false,
            is_scheduled: null,
            scheduled_dates: null,
            ideas: [],
            stage: null,
            favourite_for_user_ids: [],
            deleted_at: null,
            sort_by_date: null,
            last_author: {
              id: 100003,
              userid: "test-user-3",
              friendly_name: "Test User 3",
            },
          },
          force_update: 1,
          publish: 1,
        },
      },
      mockResponse: {
        data: {
          story: {
            id: 200003, // New ID after restoration
            name: "grandchild-story",
            slug: "grandchild-story",
            full_slug: "parent-story/child-story/grandchild-story",
            parent_id: 200002, // Should be replaced with mapped ID
            is_folder: false,
            published: true,
            content: {
              _uid: "test-uid-3",
              component: "page",
              body: [],
            },
            created_at: "2025-01-01T00:00:00.000Z",
            updated_at: "2025-01-01T00:00:00.000Z",
            published_at: "2025-01-01T00:00:00.000Z",
            first_published_at: "2025-01-01T00:00:00.000Z",
            last_author_id: 100003,
            position: 0,
            tag_list: [],
            alternates: [],
            translated_slugs: [],
            localized_paths: [],
            translated_stories: [],
            breadcrumbs: [],
            user_ids: [],
            space_role_ids: [],
            group_id: "test-group-id-3",
            uuid: "test-uuid-3",
            path: null,
            default_root: null,
            disble_fe_editor: false,
            disable_fe_editor: false,
            parent: null,
            is_startpage: false,
            unpublished_changes: false,
            meta_data: null,
            imported_at: null,
            pinned: false,
            publish_at: null,
            expire_at: null,
            can_not_view: false,
            is_scheduled: null,
            scheduled_dates: null,
            ideas: [],
            stage: null,
            favourite_for_user_ids: [],
            deleted_at: null,
            sort_by_date: null,
            last_author: {
              id: 100003,
              userid: "test-user-3",
              friendly_name: "Test User 3",
            },
          },
        },
      },
    },
  ],
  expectedFinalMappingRegistry: {
    [ResourceType.STORIES]: {
      oldIdToNewIdMap: {
        100001: 200001, // Parent story mapping
        100002: 200002, // Child story mapping
        100003: 200003, // Grandchild story mapping
      },
      oldUuidToNewUuidMap: {
        "test-uuid-1": "test-uuid-1",
        "test-uuid-2": "test-uuid-2",
        "test-uuid-3": "test-uuid-3",
      },
    },
  },
};

export default config;
